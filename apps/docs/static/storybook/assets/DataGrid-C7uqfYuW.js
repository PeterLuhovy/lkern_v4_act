import{j as r}from"./jsx-runtime-D_zvdyIk.js";import{r as m,R as Ce}from"./index-BKyFwriW.js";import{u as be}from"./ToastContext-ErSnUSL6.js";import{B as Se}from"./Button-gnwGUMlA.js";import{C as oe}from"./Checkbox-MVv5Yvl3.js";const de={dataGrid:{rowHeight:48,headerHeight:60}},ke="DataGrid-module__dataGrid___eiS3e",Ee="DataGrid-module__emptyRow___cfXmA",He="DataGrid-module__emptyRowContent___qwDTo",Ne="DataGrid-module__emptyTitle___RfYRA",Ae="DataGrid-module__emptyHint___jK2aT",Te="DataGrid-module__errorIcon___-NU0V",$e="DataGrid-module__errorTitle___P7Kpe",Me="DataGrid-module__errorHint___5FW6c",ze="DataGrid-module__loadingSpinner___XAziU",Re="DataGrid-module__loadingTitle___jmYHb",We="DataGrid-module__loadingHint___ak8Vy",Fe="DataGrid-module__retryButton___Lq2XC",Xe="DataGrid-module__header___DUq3J",Oe="DataGrid-module__headerCell___BYtOh",Le="DataGrid-module__headerCellFirst___Xcj-Z",Ke="DataGrid-module__headerCellSortable___QF-Wg",Be="DataGrid-module__sortIcon___8rf8z",Ve="DataGrid-module__sortIconActive___e4bXi",Ue="DataGrid-module__resizeHandle___Yhr2U",Ye="DataGrid-module__row___g6yZ5",Pe="DataGrid-module__rowExpanded___baZ4e",Je="DataGrid-module__cell___CGH1w",qe="DataGrid-module__rowSelected___GaoMw",Ze="DataGrid-module__expandArrow___Gouu9",Ie="DataGrid-module__expandArrowExpanded___5jlU1",Qe="DataGrid-module__expanded___J-9T4",et="DataGrid-module__expandedContent___3-Xg9",tt="DataGrid-module__dataGridCompact___nXhWy",s={dataGrid:ke,emptyRow:Ee,emptyRowContent:He,emptyTitle:Ne,emptyHint:Ae,errorIcon:Te,errorTitle:$e,errorHint:Me,loadingSpinner:ze,loadingTitle:Re,loadingHint:We,retryButton:Fe,header:Xe,headerCell:Oe,headerCellFirst:Le,headerCellSortable:Ke,sortIcon:Be,sortIconActive:Ve,resizeHandle:Ue,row:Ye,rowExpanded:Pe,cell:Je,rowSelected:qe,expandArrow:Ze,expandArrowExpanded:Ie,expanded:Qe,expandedContent:et,dataGridCompact:tt},ct=({data:_,columns:X,sortField:E="",sortDirection:O="asc",onSort:L,onRowDoubleClick:H,expandedRows:ie=new Set,onRowToggle:K,renderExpandedContent:D,getRowId:v=i=>i.id||String(Math.random()),getRowStatus:B,statusColors:V={},statusLabels:at={},showStatusLegend:rt=!1,hasActiveFilters:ce=!1,selectedRows:w=new Set,onSelectionChange:u,enableSelection:y=!1,isRowSelectable:G,compactMode:me=!1,actions:j,actionsLabel:U,actionsWidth:Y,gridId:b="dataGrid",itemsPerPage:P=10,loading:N=!1,loadingMessage:ue,loadingSlow:he=!1,error:S=null,onRetry:J})=>{const{t:i}=be(),[q,_e]=m.useState(!1);m.useEffect(()=>{const e=()=>{const a=document.documentElement.getAttribute("data-theme");_e(a==="dark")};e();const t=new MutationObserver(e);return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>t.disconnect()},[]);const p=Ce.useMemo(()=>{let e=[...X];if((y||!!D)&&(e=[{title:"",field:"_selection",sortable:!1,width:80},...e]),j&&j.length>0){const a=j.length*40+(j.length-1)*6+20,o=Y||a,n={title:U||i("common.actions")||"Actions",field:"_actions",sortable:!1,width:o,render:(c,f)=>r.jsx("div",{style:{display:"flex",gap:"6px",justifyContent:"center"},children:j.filter(l=>!l.hidden||!l.hidden(f)).map((l,d)=>r.jsx(Se,{variant:l.variant||"secondary",size:"small",onClick:h=>{h.stopPropagation(),l.onClick(f,h)},disabled:l.disabled?l.disabled(f):!1,title:l.title,children:l.label},d))})};e=[...e,n]}return e},[X,j,U,Y,i,y,D]),[g,A]=m.useState(()=>{const e=localStorage.getItem(`dataGrid-${b}-widths`);if(e)try{const t=JSON.parse(e);if(Array.isArray(t)&&t.length===p.length)return t}catch{}return p.map(t=>t.width||180)});m.useEffect(()=>{g.length>0&&g.length===p.length&&localStorage.setItem(`dataGrid-${b}-widths`,JSON.stringify(g))},[g,b,p.length]),m.useEffect(()=>{const e=t=>{if(t.key===`dataGrid-${b}-widths`&&t.newValue)try{const a=JSON.parse(t.newValue);Array.isArray(a)&&a.length===p.length&&A(a)}catch{}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[b,p.length]);const[T,Z]=m.useState(-1),C=m.useRef(null),pe=e=>{if(u)if(e.target.checked){const t=G?_.filter(o=>G(o)):_,a=new Set(t.map(o=>v(o)));u(a)}else u(new Set)},fe=(e,t)=>{if(!u)return;const a=new Set(w);t.target.checked?a.add(e):a.delete(e),u(a)},ye=(e,t,a)=>{if(C.current){const n=Math.abs(a.clientX-C.current.x),c=Math.abs(a.clientY-C.current.y);if(n>5||c>5){C.current=null;return}}if(C.current=null,!y||!u){F(e);return}if(a.ctrlKey||a.metaKey){a.stopPropagation();const n=new Set(w);n.has(e)?n.delete(e):n.add(e),u(n),Z(t);return}if(a.shiftKey&&T!==-1){a.stopPropagation();const n=new Set(w),c=Math.min(T,t),f=Math.max(T,t);for(let l=c;l<=f;l++)n.add(v(_[l]));u(n);return}F(e),Z(t)},xe=e=>{C.current={x:e.clientX,y:e.clientY}},$=G?_.filter(e=>G(e)):_,I=y&&$.length>0&&$.every(e=>w.has(v(e))),ve=y&&$.some(e=>w.has(v(e))),[k,Q]=m.useState(!1),[M,ee]=m.useState(-1),te=m.useRef(0),ae=m.useRef(0),we=(e,t)=>{e.preventDefault(),e.stopPropagation(),Q(!0),ee(t),te.current=e.clientX,ae.current=g[t]},z=m.useCallback(e=>{if(!k||M===-1)return;const t=e.clientX-te.current,a=Math.max(50,ae.current+t);A(o=>{const n=[...o];return n[M]=a,n})},[k,M]),R=m.useCallback(()=>{Q(!1),ee(-1)},[]),ge=e=>{const t=p[e];if(!t)return;const o=document.createElement("canvas").getContext("2d");if(!o)return;const n=document.querySelector(`.${s.headerCell}`),c=n?window.getComputedStyle(n):null,f=c?`${c.fontWeight} ${c.fontSize} ${c.fontFamily}`:"16px sans-serif";o.font=f;let l=o.measureText(t.title).width;_.forEach(h=>{const x=t.render?t.render(h[t.field],h):h[t.field],je=typeof x=="string"||typeof x=="number"?String(x):"",le=o.measureText(je).width;le>l&&(l=le)});const d=Math.max(100,Math.ceil(l+62));A(h=>{const x=[...h];return x[e]=d,x})};m.useEffect(()=>{if(k)return document.addEventListener("mousemove",z),document.addEventListener("mouseup",R),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",R),document.body.style.cursor="",document.body.style.userSelect=""}},[k,z,R]);const W=m.useRef(new Map),re=e=>{if(e<0||e>=_.length)return;const t=v(_[e]),a=W.current.get(t);a&&a.focus()},De=(e,t,a)=>{const o=v(t);switch(e.key){case"ArrowDown":e.preventDefault(),re(a+1);break;case"ArrowUp":e.preventDefault(),re(a-1);break;case"Enter":e.preventDefault(),F(o);break;case" ":if(e.preventDefault(),y&&u){const n=new Set(w);n.has(o)?n.delete(o):n.add(o),u(n)}break;case"a":case"A":if((e.ctrlKey||e.metaKey)&&y&&u){e.preventDefault();const n=new Set(_.map(c=>v(c)));u(n)}break;case"Escape":y&&u&&(e.preventDefault(),u(new Set));break}},se=e=>{L&&L(e)},F=e=>{K&&K(e)},ne=_.length===0,Ge={5:"300px",10:"588px",20:"1068px",50:"2508px",100:"4908px"}[P]||`${de.dataGrid.headerHeight+(P+1)*de.dataGrid.rowHeight}px`;return r.jsxs("div",{className:`${s.dataGrid} ${me?s.dataGridCompact:""}`,style:{height:Ge,overflow:"auto"},role:"grid","aria-label":i("common.dataGrid")||"Data grid","aria-rowcount":_.length+1,"aria-colcount":p.length,children:[r.jsx("div",{className:s.header,role:"row","aria-rowindex":1,children:p.map((e,t)=>r.jsxs("div",{className:`${s.headerCell} ${t===0?s.headerCellFirst:""} ${e.sortable?s.headerCellSortable:""}`,style:{width:`${g[t]}px`,flex:e.flex?"1":"0 0 auto",position:"relative"},role:"columnheader","aria-sort":e.sortable?E===e.field?O==="asc"?"ascending":"descending":"none":void 0,"aria-colindex":t+1,tabIndex:e.sortable?0:-1,onClick:()=>{e.sortable&&se(e.field)},onKeyDown:a=>{e.sortable&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),se(e.field))},children:[t===0&&y?r.jsx(oe,{checked:I,indeterminate:ve&&!I,onChange:pe,"aria-label":i("common.selectAll")||"Select all rows"}):t===0?r.jsx("span",{children:e.title}):null,t!==0&&r.jsx("span",{children:e.title}),t!==0&&e.sortable&&r.jsx("span",{className:`${s.sortIcon} ${E===e.field?s.sortIconActive:""}`,"aria-hidden":"true",children:E===e.field?O==="asc"?"▲":"▼":"▲▼"}),t<p.length-1&&r.jsx("div",{className:s.resizeHandle,onMouseDown:a=>we(a,t),onDoubleClick:a=>{a.stopPropagation(),ge(t)},onClick:a=>a.stopPropagation(),"aria-label":i("common.resizeColumn")||"Resize column"})]},t))}),N&&!S&&r.jsx("div",{className:s.emptyRow,role:"row",children:r.jsxs("div",{className:s.emptyRowContent,role:"gridcell",children:[r.jsx("div",{className:s.loadingSpinner,role:"img","aria-hidden":"true",children:"⏳"}),r.jsx("div",{className:s.loadingTitle,children:ue||i("pageTemplate.dataGrid.loading",{defaultValue:"Načítavam dáta..."})}),he&&r.jsx("div",{className:s.loadingHint,children:i("pageTemplate.dataGrid.loadingSlow",{defaultValue:"Trvá to dlhšie ako obvykle..."})})]})}),S&&!N&&r.jsx("div",{className:s.emptyRow,role:"row",children:r.jsxs("div",{className:s.emptyRowContent,role:"gridcell",children:[r.jsx("div",{className:s.errorIcon,role:"img","aria-hidden":"true",children:"⚠️"}),r.jsx("div",{className:s.errorTitle,children:i("pageTemplate.dataGrid.serviceUnavailable",{defaultValue:"Servis nedostupný"})}),r.jsx("div",{className:s.errorHint,children:S}),J&&r.jsx("button",{className:s.retryButton,onClick:J,children:i("common.retry",{defaultValue:"Skúsiť znova"})})]})}),ne&&!S&&!N&&r.jsx("div",{className:s.emptyRow,role:"row",children:r.jsx("div",{className:s.emptyRowContent,role:"gridcell",children:ce?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:s.emptyTitle,children:i("pageTemplate.dataGrid.noFilterResults")}),r.jsx("div",{className:s.emptyHint,children:i("pageTemplate.dataGrid.noFilterResultsHint")})]}):r.jsx("div",{className:s.emptyTitle,children:i("pageTemplate.dataGrid.emptyState")})})}),!ne&&_.map((e,t)=>{const a=v(e),o=ie.has(a),n=w.has(a);let c,f,l;if(B&&V){const d=B(e);l=V[d],l&&(c=o?`${l}${q?"B3":"FF"}`:`${l}${q?"66":"80"}`,f=`${l}26`)}return r.jsxs("div",{style:{width:"max-content",minWidth:"100%"},children:[r.jsx("div",{ref:d=>{d?W.current.set(a,d):W.current.delete(a)},className:`${s.row} ${o?s.rowExpanded:""} ${n?s.rowSelected:""}`,style:{...c?{backgroundColor:c}:{},...o&&l?{"--status-color":l}:{}},role:"row","aria-rowindex":t+2,"aria-selected":n,"aria-expanded":D?o:void 0,tabIndex:0,onMouseDown:xe,onClick:d=>ye(a,t,d),onDoubleClick:()=>H==null?void 0:H(e),onKeyDown:d=>De(d,e,t),children:p.map((d,h)=>r.jsx("div",{className:s.cell,style:{width:`${g[h]}px`,flex:d.flex?"1":"0 0 auto"},role:"gridcell","aria-colindex":h+1,children:d.field==="_selection"?r.jsxs(r.Fragment,{children:[y&&r.jsx(oe,{checked:n,onChange:x=>fe(a,x),disabled:G?!G(e):!1,"aria-label":i("common.selectRow")||"Select row"}),D&&r.jsx("span",{className:`${s.expandArrow} ${o?s.expandArrowExpanded:""}`,"aria-hidden":"true",children:"▶"})]}):d.render?d.render(e[d.field],e):e[d.field]},h))}),o&&D&&r.jsx("div",{className:s.expanded,style:{...f?{backgroundColor:f}:{},...l?{"--status-color":l}:{}},role:"row","aria-rowindex":t+2,children:r.jsx("div",{role:"gridcell","aria-colindex":1,style:{gridColumn:"1 / -1"},children:r.jsx("div",{className:s.expandedContent,children:D(e)})})})]},a)})]})};export{ct as D};
