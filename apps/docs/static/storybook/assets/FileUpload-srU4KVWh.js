import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as s}from"./index-BKyFwriW.js";import{u as Q}from"./ToastContext-ErSnUSL6.js";const Z="FileUpload-module__fileUpload___NoCaX",q="FileUpload-module__dropzone___mPRV1",G="FileUpload-module__dropzoneDragging___8RiiD",Y="FileUpload-module__dropzoneError___yVTh5",ee="FileUpload-module__dropzoneDisabled___ydD-M",oe="FileUpload-module__dropzoneContent___SrWq8",ne="FileUpload-module__dropzoneIconDisabled___COk60",te="FileUpload-module__fileInputHidden___VW7Sn",ie="FileUpload-module__dropzoneIcon___ocTXk",le="FileUpload-module__dropzoneText___HVgn7",se="FileUpload-module__dropzoneHint___kevRM",re="FileUpload-module__fileHint___fX2HQ",de="FileUpload-module__error___V8EK-",ae="FileUpload-module__warning___OGfyr",pe="FileUpload-module__warningHidden___-lISB",ce="FileUpload-module__info___2iLtZ",fe="FileUpload-module__fileList___J0r8x",_e="FileUpload-module__fileItem___etV1-",me="FileUpload-module__fileName___QyEgf",ue="FileUpload-module__fileSize___DJF6N",ge="FileUpload-module__removeFileBtn___xZ-lw",n={fileUpload:Z,dropzone:q,dropzoneDragging:G,dropzoneError:Y,dropzoneDisabled:ee,dropzoneContent:oe,dropzoneIconDisabled:ne,fileInputHidden:te,dropzoneIcon:ie,dropzoneText:le,dropzoneHint:se,fileHint:re,error:de,warning:ae,warningHidden:pe,info:ce,fileList:fe,fileItem:_e,fileName:me,fileSize:ue,removeFileBtn:ge};function Ue({value:i,onChange:f,maxFiles:r=5,maxSize:u=10*1024*1024,accept:S="image/*,.pdf,.log,.txt",error:g,onError:a,onFileLimitExceeded:x,onPasteLimitReached:_,dropzoneText:T,dropzoneHint:b,enablePaste:v=!0,enableDragDrop:p=!0,showHint:k=!0}){const{t:d}=Q(),[O,N]=s.useState(!1),[z,w]=s.useState(""),$=s.useRef(null),A=s.useRef(null),m=s.useRef(0);s.useEffect(()=>{x&&x(i.length>r),i.length<=r&&z&&w("")},[i.length,r,x,z]);const h=s.useCallback(e=>{if(e.filter(l=>l.size>u).length>0){const l=(u/1048576).toFixed(0);return{valid:[],error:d("components.fileUpload.errors.maxSize",{max:l})}}return{valid:e}},[u,d]),j=s.useCallback(e=>{const o=h(e);if(o.error){a&&a(o.error);return}w("");const l=[...i,...o.valid];f(l)},[i,h,a,f]),y=s.useCallback(e=>{if(i.length>=r){_&&_();return}const o=h(e);if(o.error){a&&a(o.error);return}const l=r-i.length,c=o.valid.slice(0,l),U=[...i,...c];f(U),o.valid.length>l&&_&&_()},[i,r,h,a,f,_]),B=e=>{const o=e.target.files;!o||o.length===0||(j(Array.from(o)),e.target.value="")},R=e=>{const o=i.filter((l,c)=>c!==e);f(o),a&&g&&a("")},M=s.useCallback(e=>{p&&(e.preventDefault(),e.stopPropagation(),m.current++,m.current===1&&N(!0))},[p]),V=e=>{p&&(e.preventDefault(),e.stopPropagation())},E=s.useCallback(e=>{p&&(e.preventDefault(),e.stopPropagation(),m.current--,m.current===0&&N(!1))},[p]),L=s.useCallback(e=>{if(!p||(e.preventDefault(),e.stopPropagation(),m.current=0,N(!1),i.length>=r))return;const o=e.dataTransfer.files;o&&o.length>0&&j(Array.from(o))},[p,i.length,r,j]);s.useEffect(()=>{if(!v)return;const e=o=>{var U;const l=(U=o.clipboardData)==null?void 0:U.items;if(!l)return;const c=[];for(let I=0;I<l.length;I++){const C=l[I];if(C.type.startsWith("image/")){const H=C.getAsFile();if(H){const J=new Date().toISOString().replace(/[:.]/g,"-"),K=new File([H],`screenshot-${J}.png`,{type:H.type});c.push(K)}}}c.length>0&&(o.preventDefault(),y(c))};return document.addEventListener("paste",e),()=>document.removeEventListener("paste",e)},[v,y]);const P=(u/(1024*1024)).toFixed(0),W=T||d("components.fileUpload.dropzoneText"),X=b||d("components.fileUpload.dropzoneHint",{max:r}),D=i.length>r,F=i.length>=r;return t.jsxs("div",{className:n.fileUpload,children:[t.jsxs("div",{ref:$,className:`${n.dropzone} ${O&&!F?n.dropzoneDragging:""} ${g||D?n.dropzoneError:""} ${F?n.dropzoneDisabled:""}`,onDragEnter:M,onDragOver:V,onDragLeave:E,onDrop:L,"data-testid":"file-upload-dropzone",children:[!F&&t.jsx("input",{ref:A,type:"file",multiple:!0,accept:S,onChange:B,className:n.fileInputHidden,id:"file-upload-input","data-testid":"file-upload-input"}),F?t.jsxs("div",{className:n.dropzoneContent,children:[t.jsx("span",{className:n.dropzoneIconDisabled,role:"img","aria-hidden":"true",children:"ðŸš«"}),t.jsx("span",{className:n.dropzoneText,children:d("components.fileUpload.limitReached")}),t.jsx("span",{className:n.dropzoneHint,children:d("components.fileUpload.removeToAdd")})]}):t.jsxs("label",{htmlFor:"file-upload-input",className:n.dropzoneContent,children:[t.jsx("span",{className:n.dropzoneIcon,role:"img","aria-hidden":"true",children:"ðŸ“Ž"}),t.jsx("span",{className:n.dropzoneText,children:W}),t.jsx("span",{className:n.dropzoneHint,children:X})]})]}),k&&t.jsx("div",{className:n.fileHint,children:d("components.fileUpload.fileHint",{max:P})}),g&&t.jsx("span",{className:n.error,children:g}),t.jsxs("span",{className:`${n.warning} ${D?"":n.warningHidden}`,"data-testid":"file-upload-warning",children:[t.jsx("span",{role:"img","aria-hidden":"true",children:"âš ï¸"})," ",d("components.fileUpload.errors.maxFiles",{max:r})," - ",d("components.fileUpload.removeToSubmit")]}),z&&!D&&t.jsxs("span",{className:n.info,"data-testid":"file-upload-info",children:[t.jsx("span",{role:"img","aria-hidden":"true",children:"â„¹ï¸"})," ",z]}),i.length>0&&t.jsx("div",{className:n.fileList,"data-testid":"file-upload-list",children:i.map((e,o)=>t.jsxs("div",{className:n.fileItem,"data-testid":`file-item-${o}`,children:[t.jsxs("span",{className:n.fileName,children:[t.jsx("span",{role:"img","aria-hidden":"true",children:"ðŸ“Ž"})," ",e.name," ",t.jsxs("span",{className:n.fileSize,children:["(",(e.size/1024).toFixed(1)," KB)"]})]}),t.jsx("button",{type:"button",className:n.removeFileBtn,onClick:()=>R(o),title:d("components.fileUpload.removeFile"),"data-testid":`file-remove-${o}`,children:"âœ•"})]},o))})]})}export{Ue as F};
